<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.heybooks.sh.mybatis.Item_Mapper">
	 
	<!-- 상품 총 데이터 수 -->   
	<select id="get_count" resultType="int">
		select NVL(count(*),0) cnt from products    
	</select> 
	
	<!-- 1. 상품 추가 -->
	<update id="item_insert" parameterType="com.heybooks.sh.vo.item.Item_Vo">
		update products set product_cate_num= #{product_cate_num}, product_editor_num = #{product_editor_num}, product_publish = #{product_publish} , product_name = #{product_name}, product_page = #{product_page}, 
		                    product_discription = #{product_discription}, product_index = #{product_index}, product_status = #{product_status}, product_view = #{product_view}, product_shipping_charge = #{product_shipping_charge}, product_discount = #{product_discount}, product_price = #{product_price},
		                    product_discount_price = #{product_discount_price}, product_supplement = #{product_supplement}, product_stock = #{product_stock} where product_num = #{product_num}
	</update> 
	<!-- 상품 이미지 추가 -->
	 <insert id="item_img_insert" parameterType="com.heybooks.sh.vo.item.Item_Vo">
		insert into products values (#{product_num}, 110, null, 'a', 'a', 0, null, null, 'a', 'a','a', 'a', 'a','a', 0, 0, #{product_picture}, #{product_preview}, sysdate ,sysdate)
	</insert> 
	<!-- 2. 상품 리스트 --> 
	<select id="item_list" parameterType="HashMap" resultType="com.heybooks.sh.vo.item.Item_Vo"> 
		select * from 
		( 
			select aa.*, rownum rnum from
			(
				select * from products 
				<if test ="cate_num != null">
				where product_cate_num = #{cate_num}
				</if>
				order by ${list_arr}  
				
			)aa      
		)    
		<![CDATA[ where rnum >= #{startRow} and rnum <= #{endRow} ]]>
	</select> 
	<!-- 3. 상품 삭제 -->
	<delete id="item_delete" parameterType="int">
		delete products where product_num = #{product_num}
	</delete>
	
	<!-- 4. 상품 상세 정보 -->
	<select id="item_getinfo" parameterType="int" resultType="com.heybooks.sh.vo.item.Item_Vo">
		select * from products where product_num = #{product_num}
	</select>
	
	<!-- 5. 상품 이미지 수정 -->
	 <update id="item_img_update" parameterType="com.heybooks.sh.vo.item.Item_Vo">
		update products set product_picture = #{product_picture}, product_preview = #{product_preview} where product_num = #{product_num}
	</update> 
	
	  
	   
	   
	   
	  
	<!-- 아이템 카테고리 -->   
	<select id="cate_list"  parameterType="string" resultType="com.heybooks.sh.vo.item.Item_Cate_Vo">
		select * from product_category where  (cate_ref2  = #{cate_code} and cate_ref3 IS NULL) or cate_ref3 = #{cate_code} 
	</select>	  
	
	<!-- 작가 총 데이터 수 -->   
	<select id="editor_get_count" resultType="int">
		select NVL(count(*),0) cnt from editor
	</select>   
	<!-- 1. 작가 등록 -->
	<insert id="editor_insert" parameterType="com.heybooks.sh.vo.item.Item_Editor_Vo">
		insert into editor values(seq_editor_num.nextval, #{editor_name},#{editor_birth},#{editor_nation},#{editor_introduce},#{editor_school},#{editor_award},sysdate)
	</insert> 
	<!-- 2. 작가 리스트 -->
	<select id="editor_list" parameterType="HashMap" resultType="com.heybooks.sh.vo.item.Item_Editor_Vo">
		select * from 
		( 
			select aa.*, rownum rnum from
			(
				select * from editor
				order by ${list_arr} 
			)aa       
		)     
		<![CDATA[ where rnum >= #{startRow} and rnum <= #{endRow} ]]>	
	</select>
	<!-- 3. 작가 삭제 --> 
	<delete id="editor_delete" parameterType="int">
		delete from editor where editor_num = #{editor_num}
	</delete>
		
	<!-- 작가 삭제시 해당 책의 작가 값 비우기 -->  
	<update id="item_editor_null" parameterType="int">
		update products set product_editor_num = null where product_editor_num = #{editor_num}
	</update> 
	     
	
	<!-- 4. 작가 정보 -->
	<select id="editor_getinfo" parameterType="int" resultType="com.heybooks.sh.vo.item.Item_Editor_Vo">
		select * from editor where editor_num = #{editor_num}
	</select>
	<!-- 작가 정보 수정 -->
	<update id="editor_update" parameterType="com.heybooks.sh.vo.item.Item_Editor_Vo">
	 	update editor set editor_name = #{editor_name}, editor_birth = #{editor_birth}, editor_nation = #{editor_nation}, editor_introduce = #{editor_introduce}, 
	 					  editor_school = #{editor_school}, editor_award = #{editor_award} 
	 				  where editor_num = #{editor_num}
	</update>
	<!-- 5. 출판사 리스트 -->
	<select id="publishing_list" resultType="String">
		select product_publish from products order by product_date
	</select>
	
	<!-- 6. 상품 카테고리 이름 얻어오기 (추후 개선)-->
	<select id ="get_category" parameterType="HashMap" resultType="com.heybooks.sh.vo.item.Item_Cate_Vo">
		select * from product_category where cate_num = ${cate_num1}  or cate_ref1 = (select cate_ref3 from product_category where cate_num = ${cate_num2} ) or cate_ref1 = (select cate_ref2 from product_category where cate_num = ${cate_num3}) 
	</select>
	  
	  
    <!-- 주문 관리 -->
	
	<!-- 1. 장바구니 추가 -->
	<insert id="cart_insert" parameterType="com.heybooks.sh.vo.item.Cart_Vo">
		insert into cart_item values(cart_num_seq.nextVal, #{members_num}, #{product_num}, #{cart_item_quantity}, sysdate)
	</insert>
	<!-- 2. 장바구니 목록 -->
	<select id="cart_list" parameterType="int" resultType="com.heybooks.sh.vo.item.Cart_Vo">
		select * from cart_item where members_num = #{members_num}		
	</select>
	
	
		  
</mapper>   


 

  
















